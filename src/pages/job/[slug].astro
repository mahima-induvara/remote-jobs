---
import "../../styles/global.css";
import Layout from "@layouts/JobLayout.astro";

// Define the Post type
interface Post {
  id: number;
  slug: string;
  title: {
    rendered: string;
  };
  content: {
    rendered: string;
  };
  date: string;
  excerpt: {
    rendered: string;
  };
}

export async function getStaticPaths() {
  // Fetch all posts to generate static paths
  const url = `https://remotejobsinasia.com/wp-json/wp/v2/posts?per_page=100`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const posts: Post[] = await response.json();

    return posts.map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
  } catch (error) {
    console.error("Failed to fetch posts:", error);
    return [];
  }
}

// Access the slug and post data
const { slug } = Astro.params;
const { post }: { post: Post } = Astro.props;

// If no post is found, return 404
if (!post) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}
---

<Layout title={post.title.rendered} description={post.excerpt.rendered}>
  <main class="job-post-container">
    <div class="max-w-7xl mx-auto px-4 py-8 mt-[80px]">
      <article class="job-post">
        <header class="job-header mb-8">
          <h1 class="job-title text-3xl font-bold text-gray-900 mb-4">{post.title.rendered}</h1>
          <div class="job-meta text-gray-600">
            <time datetime={post.date}>
              {new Date(post.date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
          </div>
        </header>
        
        <div class="job-content prose prose-lg max-w-none">
          <div set:html={post.content.rendered} />
        </div>
        
        <footer class="job-footer mt-12 pt-8 border-t border-gray-200">
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="/jobs" class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              ‚Üê Back to Jobs
            </a>
            <a href="/contact" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Apply Now
            </a>
          </div>
        </footer>
      </article>
    </div>
  </main>
</Layout>

<style>
  .job-post-container {
    font-family: system-ui, -apple-system, sans-serif;
  }
  
  .job-title {
    line-height: 1.2;
  }
  
  .job-content {
    line-height: 1.6;
  }
  
  .job-content :global(h1),
  .job-content :global(h2),
  .job-content :global(h3),
  .job-content :global(h4),
  .job-content :global(h5),
  .job-content :global(h6) {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 600;
    color: #1f2937;
  }
  
  .job-content :global(p) {
    margin-bottom: 1rem;
    color: #374151;
  }
  
  .job-content :global(ul),
  .job-content :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  
  .job-content :global(li) {
    margin-bottom: 0.5rem;
  }
  
  .job-content :global(strong) {
    font-weight: 600;
    color: #1f2937;
  }
  
  .job-content :global(a) {
    color: #2563eb;
    text-decoration: underline;
  }
  
  .job-content :global(a:hover) {
    color: #1d4ed8;
  }
</style>
