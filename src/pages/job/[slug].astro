---
import "../../styles/global.css";
import "@styles/job.scss";
import Layout from "@layouts/JobLayout.astro";
import type { JobData } from "@lib/types";
import { fetchJobsPages } from "@lib/wp";

// export async function getStaticPaths() {
//   // Fetch all posts to generate static paths
//   const url = `https://remotejobsinasia.com/wp-json/wp/v2/posts?per_page=100`;

//   try {
//     const response = await fetch(url);
//     if (!response.ok) {
//       throw new Error(`HTTP error! status: ${response.status}`);
//     }
//     const posts: Post[] = await response.json();

//     return posts.map((post) => ({
//       params: { slug: post.slug },
//       props: { post },
//     }));
//   } catch (error) {
//     console.error("Failed to fetch posts:", error);
//     return [];
//   }
// }
export async function getStaticPaths() {
  try {
    const posts = await fetchJobsPages(100);
    return posts.map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
  } catch (e) {
    console.error(e);
    return [];
  }
}

// Access the slug and post data
const { slug } = Astro.params;
const { post }: { post: JobData } = Astro.props;

// If no post is found, return 404
if (!post) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}

const recentJobs = [
  { title: "Accountant", timeAgo: "4 weeks ago" },
  { title: "Senior Bookkeeper", timeAgo: "3 weeks ago" },
  { title: "Finance Manager", timeAgo: "2 weeks ago" },
];
---

<Layout title={post.title} description={`Apply for ${post.title} at ${post.company}`}>
 <article class="job-page mt-[80px]">
    <!-- Hero -->
    <section
      class="job-hero"
      style={`background-image: linear-gradient(45deg, rgba(232,27,57,0.7), rgba(16,25,93,0.7)), url('https://remotejobsinasia.com/wp-content/uploads/2025/08/inside-banner.webp')`}
    >
      <div class="container">
        <h1 class="job-title">{post.title}</h1>
        <div class="job-meta">
          <span class="pill">{post.job_listing_type}</span>
          <span class="meta-item">{post.location}</span>
          <span class="meta-item">{post.job_expires}</span>
        </div>
      </div>
    </section>

    <div class="max-w-7xl mx-auto px-4 py-16 page-content flex lg:flex-row flex-col">
      <div class="main-col lg:w-2/3 w-full">
        <!-- Company block -->
        <div class="company-block">
          <img src={post.image_url} alt={post.company} class="company-logo" />
          <div class="company-info">
            <h2>{post.company}</h2>
            <a href="https://leveingroup.com/" target="_blank" rel="noopener">
              https://leveingroup.com/
            </a>
          </div>
        </div>

        <!-- About Us -->
        <section id="about-us" class="section">
          <h3>About Us</h3>
          <p>At Levein Group, we’re driving digital innovation across UK’s most dynamic sectors – from healthcare and fintech to hospitality and tech startups, all from our vibrant hub in Colombo, Sri Lanka. Join our passionate team of technologists where your creativity and skills can transform multiple industries. We offer more than just a job – we provide an environment where innovation meets purpose, where your growth matters, and where your solutions impact leading UK businesses. Ready to work on diverse, cutting-edge projects?</p>
        </section>

        <!-- Job Description -->
        <section id="description" class="section">
          <h3>Job Description</h3>
          <div set:html={post.job_description} />
        </section>

        <!-- Requirements -->
        <section id="requirements" class="section">
          <h3>Requirements</h3>
          <div set:html={post.job_requirements} />
        </section>

        <!-- Benefits -->
        <section id="benefits" class="section">
          <h3>Benefits</h3>
          <div set:html={post.job_benefits} />
        </section>
       <section class="job-footer mt-12 mb-6 pt-8 border-t border-gray-200">
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="/" class="back-to-job">
              ← Back to Jobs
            </a>
            <a href="/contact" class="btn-apply">
              Apply Now →
            </a>
          </div>
        </section>
        <!-- Recent Jobs -->
        <section class="section recent-jobs hidden lg:block">
          <h3>Recent Jobs</h3>
          <ul class="recent-list">
            {recentJobs.map((r) => (
              <li>
                <span>{r.title}</span>
                <button class="apply-btn">Apply Now</button>
                <small>{r.timeAgo}</small>
              </li>
            ))}
          </ul>
        </section>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar lg:w-1/3">
        <div class="apply-box">
          <p>Click below to submit your resume and send your application directly to the employer.</p>
          <button class="btn-apply">Apply Now</button>
        </div>
        <div class="overview">
          <h4>Job Overview</h4>
          <ul class="flex flex-col gap-4">
            <li><strong>Contract Type:</strong> {post.job_listing_type}</li>
            <li><strong>Career Level:</strong> {post.job_level}</li>
            <li><strong>Specialism:</strong> {post.job_specialsum}</li>
            <li><strong>Experience Level:</strong> {post.job_experience}</li>
            <li><strong>Qualification:</strong> {post.job_qualification.join(", ")}</li>
          </ul>
        </div>
      </aside>
    </div>
</article>
</Layout>
