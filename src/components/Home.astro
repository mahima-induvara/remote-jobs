---
export const prerender = true;
import "@styles/site.scss";
import Jobs from "@components/Jobs"
import type { JobData } from "@components/Jobs";
import type { Categories } from '@lib/types';
import { fetchJobs } from "@lib/wp";
import { fetchCategories } from "@lib/wp";
import { getCategoryImage } from '../utils/categories';

const rows = await fetchJobs(1, 12);
const categories = await fetchCategories();

const DataSet: JobData[] = rows.map((row: any) => ({
  id: row.id ?? 0,
  title: typeof row.title === "string" ? row.title : (row.title?.rendered ?? ""),
  slug: row.slug ?? "",
  company: row.company ?? row.meta?.company ?? "Levein Group",
  image_url: row.image_url,
  date: row.job_expires ?? "",
  level: row.job_level ?? row.meta?.job_level ?? "",
  type: row.job_listing_type ?? row.meta?.job_listing_type ?? "",
  experience: row.job_experience ?? row.meta?.job_experience ?? "",
}));

const CatLogs: Categories[] = categories.map(cat => ({
  id: cat.id,
  name: cat.name,
  count: cat.count,
  slug: cat.slug,
  svg: getCategoryImage(cat.slug)
}));

const engJobs = [
  { id: 4, title: "Senior .NET Software Engineer", company: "CodeFactory", salary: "1k–3k USD/mo", location: "Remote" },
  { id: 5, title: "Senior Golang Developer", company: "Prime Holdings JSC", salary: "1.5k–3k USD/mo", location: "Remote" },
  { id: 6, title: "Senior AI Engineer", company: "InnovateAI", salary: "2k–4k USD/mo", location: "Remote" }
];


---

<!-- Hero Section -->
<section class="mt-[80px] hero px-4 py-20 text-center text-white">
  <div class="max-w-7xl mx-auto">
    <h1 class="hero-title mb-4">Find The Best Paid Remote Jobs In Asia</h1>
    <p class="hero-subtitle mb-8">Exciting opportunities across Software, Design, IT, Marketing, Finance, HR & Customer support with leading employers in UK & Europe.</p>

  </div>
  <!-- Filter Bar -->
  <section class="filter-bar py-8">
    <div class="max-w-7xl mx-auto px-4">
      <div class="relative bg-white rounded-xl shadow-md overflow-hidden filter-wrapper">
        <form class="flex flex-col lg:flex-row gap-4 items-start p-4">
          <!-- keyword + location -->
          <div class="flex-1 flex flex-col sm:flex-row gap-3 w-full">
            <div class="flex-1 min-w-0">
              <label class="sr-only" for="keyword">Job title or keywords</label>
              <div class="input-group">
                <span class="input-icon" aria-hidden="true">
                  <!-- magnifier -->
                  <svg width="16" height="16" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><path d="M16 16l4 4"></path></svg>
                </span>
                <input id="keyword" type="text" placeholder="Job title or keywords" class="filter-input w-full" />
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <label class="sr-only" for="location">Location</label>
              <div class="input-group">
                <span class="input-icon" aria-hidden="true">
                  <!-- location pin -->
                  <svg width="16" height="16" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"></path><circle cx="12" cy="9" r="2.5"></circle></svg>
                </span>
                <input id="location" type="text" placeholder="Anywhere" class="filter-input w-full" />
              </div>
            </div>
          </div>

          <!-- actions and advanced toggle -->
          <div class="flex flex-col sm:flex-row gap-3 items-start lg:items-center">
            <div class="flex gap-2 flex-wrap">
              <button type="button" class="btn btn-secondary" id="toggle-advanced">Filters ▾</button>
              <button type="submit" class="btn btn-primary">Search</button>
              <button type="reset" class="text-sm p-2 text-orange-600 cursor-pointer clear_button">Clear</button>
            </div>
          </div>

          <!-- advanced filters (desktop expandable) -->
          <div class="advanced-filters w-full mt-4 hidden-toggle lg:flex flex-wrap gap-4" id="advanced-filters">
            <div class="flex-1 min-w-[160px]">
              <label class="block text-xs font-semibold mb-1" for="department">Department / Specialism</label>
              <select id="department" class="filter-select w-full">
                <option value="">All Departments</option>
                <option>Administration and Secretarial</option>
                <option>Finance</option>
                <option>HR</option>
                <option>Information Technology</option>
                <option>Medical</option>
                <option>Projects</option>
              </select>
            </div>
            <div class="flex-1 min-w-[160px]">
              <label class="block text-xs font-semibold mb-1" for="experience">Experience Level</label>
              <select id="experience" class="filter-select w-full">
                <option value="">Any</option>
                <option>0-2 years</option>
                <option>2-4 years</option>
                <option>5-10 years</option>
              </select>
            </div>
            <div class="flex-1 min-w-[160px]">
              <label class="block text-xs font-semibold mb-1" for="contract">Contract Type</label>
              <select id="contract" class="filter-select w-full">
                <option value="">Any</option>
                <option>Contract - Part time</option>
                <option>Permanent - Full time</option>
              </select>
            </div>
          </div>
        </form>

        <!-- mobile off-canvas drawer -->
        <div class="mobile-drawer fixed inset-0 bg-black/40 backdrop-blur-sm z-30 hidden-toggle mt-[85px]" id="mobile-drawer">
          <div class="drawer-panel bg-white w-80 h-full p-6 overflow-auto">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-semibold text-lg">Filters</h3>
              <button id="close-drawer" aria-label="Close filters">✕</button>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-xs font-semibold mb-1" for="mobile-department">Department / Specialism</label>
                <select id="mobile-department" class="filter-select w-full">
                  <option value="">All Departments</option>
                  <option>Administration and Secretarial</option>
                  <option>Finance</option>
                  <option>HR</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-semibold mb-1" for="mobile-experience">Experience Level</label>
                <select id="mobile-experience" class="filter-select w-full">
                  <option value="">Any</option>
                  <option>0-2 years</option>
                  <option>2-4 years</option>
                  <option>5-10 years</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-semibold mb-1" for="mobile-contract">Contract Type</label>
                <select id="mobile-contract" class="filter-select w-full">
                  <option value="">Any</option>
                  <option>Contract - Part time</option>
                  <option>Permanent - Full time</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-semibold mb-1" for="mobile-work-mode">Work Mode</label>
                <select id="mobile-work-mode" class="filter-select w-full">
                  <option value="">Any</option>
                  <option>Hybrid</option>
                  <option>Remote</option>
                </select>
              </div>
              <div>
                <button class="btn btn-primary w-full">Apply Filters</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="max-w-7xl mx-auto">
     <div class="flex flex-col sm:flex-row gap-4 justify-center mt-0">
      <a href="/browse-job-categories" class="btn btn-primary">All Categories</a>
      <a href="/login" class="btn btn-outline">Post a Job</a>
    </div>
  </div>
</section>

<!-- Filter script -->
<script type="module">
  const toggleAdvanced = document.getElementById('toggle-advanced');
  const advanced = document.getElementById('advanced-filters');
  const mobileDrawer = document.getElementById('mobile-drawer');
  const closeDrawer = document.getElementById('close-drawer');

  const updateAdvancedVisibility = () => {
    if (window.innerWidth >= 1024) {
      // desktop: hide mobile drawer if open
      if (mobileDrawer && !mobileDrawer.classList.contains('hidden-toggle')) {
        mobileDrawer.classList.add('hidden-toggle');
      }
    } else {
      // on resize small screens, collapse advanced panel
      if (advanced && !advanced.classList.contains('hidden-toggle')) {
        advanced.classList.add('hidden-toggle');
      }
    }
  };

  toggleAdvanced?.addEventListener('click', (e) => {
    e.preventDefault();
    if (window.innerWidth >= 1024) {
      advanced?.classList.toggle('hidden-toggle');
    } else {
      mobileDrawer?.classList.remove('hidden-toggle');
    }
  });
  closeDrawer?.addEventListener('click', () => {
    mobileDrawer?.classList.add('hidden-toggle');
  });
  mobileDrawer?.addEventListener('click', (e) => {
    if (e.target === mobileDrawer) {
      closeDrawer?.click();
    }
  });
  window.addEventListener('resize', updateAdvancedVisibility);
</script>

<!-- Hot New Jobs -->
<section class="py-16">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="section-title">New Jobs</h2>
    <!-- <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
      {hotJobs.map(job => (
        <div id={`job-${job.id}`} class="job-card">
          <h3 class="job-title">{job.title}</h3>
          <p class="job-company">{job.company}</p>
          <p class="job-meta">{job.location} • {job.salary}</p>
          <button class="btn btn-primary mt-4 apply-now">Apply Now</button>
        </div>
      ))}
    </div> -->
    <Jobs JobData={DataSet} />
  </div>
</section>

<!-- Top Recent Jobs -->
<section class="py-16 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="section-title">Recent Jobs</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {engJobs.map(job => (
        <div id={`job-${job.id}`} class="job-card">
          <h3 class="job-title">{job.title}</h3>
          <p class="job-company">{job.company}</p>
          <p class="job-meta">{job.location} • {job.salary}</p>
          <button class="btn btn-primary mt-4 apply-now">Apply Now</button>
        </div>
      ))}
    </div>
  </div>
</section>

<!-- Top Design Jobs -->
<!-- <section class="py-16">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="section-title">Top Design Jobs</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {designJobs.map(job => (
        <div key={job.id} class="job-card">
          <h3 class="job-title">{job.title}</h3>
          <p class="job-company">{job.company}</p>
          <p class="job-meta">{job.location} • {job.salary}</p>
          <button class="btn btn-primary mt-4">Apply Now</button>
        </div>
      ))}
    </div>
  </div>
</section> -->

<!-- Popular Categories -->
<section class="py-16 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <h2 class="section-title">Popular Categories</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-8">
      {CatLogs.slice(0, 4).map(cat => (
        <div id={`category-${cat.id}`} class="category-card">
          <div class="category-image-wrapper">
            <Fragment set:html={cat.svg} />
          </div>
          <h3 class="category-name">{cat.name}</h3>
          <p class="category-count">{cat.count} open positions</p>
        </div>
      ))}
    </div>
  </div>
    <div class="flex flex-col sm:flex-row gap-4 justify-center lg:mt-12 mt-4 px-4">
      <a href="/browse-job-categories" class="btn button-plain">Browse All Categories</a>
    </div>
</section>

<!-- How It Works -->
<section class="py-16" id="how-it-works">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <h2 class="section-title">How It Works</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-8">
      <div class="hiw-step">
        <div class="hiw-icon">1</div>
        <h3>Browse Job Listings</h3>
        <p>Visit our job board to explore available remote positions from UK and European tech companies.</p>
      </div>
      <div class="hiw-step">
        <div class="hiw-icon">2</div>
        <h3>Find a Job You Like</h3>
        <p>Browse profiles, reviews, and proposals then interview top candidates.</p>
      </div>
      <div class="hiw-step">
        <div class="hiw-icon">3</div>
        <h3>Complete Profile & Apply for job</h3>
        <p>Once your profile is complete, you can proceed with your application.</p>
      </div>
    </div>
  </div>
</section>

